server {
    listen 8080;
    
    # Create a directory for static files
    location /static {
        alias /usr/local/openresty/html;
        index cb-dashboard.html;
    }
    
    # Circuit breaker dashboard
    location /dashboard {
        default_type text/html;
        content_by_lua_block {
            local file = io.open("/usr/local/openresty/html/cb-dashboard.html", "r")
            if file then
                local content = file:read("*all")
                file:close()
                ngx.say(content)
            else
                ngx.status = 404
                ngx.say("Circuit Breaker Dashboard not found")
            end
        }
    }
    
    # Circuit breaker status API
    location /circuit-status {
        default_type application/json;
        content_by_lua_file /usr/local/openresty/lua/circuit_status.lua;
    }
    
    location /hyperliquid {
        default_type application/json;
        # set_by_lua_block $proxy_url {
        #     return os.getenv("PROXY_URL")
        # }
        # Lua script to handle request
        content_by_lua_file /usr/local/openresty/lua/proxy.lua;
    }
    
    # Health check endpoint
    location /health {
        return 200 '{"status":"ok"}';
    }
} 